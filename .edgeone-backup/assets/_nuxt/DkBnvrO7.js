import{k as B,a as U,G as z,H as N,I as L,J as W,K as g,r as q,s as F,L as G,M as J,N as Q,O as X,P as Y,Q as Z,R as $,S as x,T as K,U as k,d as A,y as p,A as b,F as ee,B as w,z as S,_ as ae}from"#entry";const te={trailing:!0};function se(e,a=25,i={}){if(i={...te,...i},!Number.isFinite(a))throw new TypeError("Expected `wait` to be a finite number");let c,s,_=[],n,t;const h=(u,v)=>(n=ne(e,u,v),n.finally(()=>{if(n=null,i.trailing&&t&&!s){const P=h(u,t);return t=null,P}}),n),m=function(...u){return i.trailing&&(t=u),n||new Promise(v=>{const P=!s&&i.leading;clearTimeout(s),s=setTimeout(()=>{s=null;const l=i.leading?c:h(this,u);t=null;for(const o of _)o(l);_=[]},a),P?(c=h(this,u),v(c)):_.push(v)})},r=u=>{u&&(clearTimeout(u),s=null)};return m.isPending=()=>!!s,m.cancel=()=>{r(s),_=[],t=null},m.flush=()=>{if(r(s),!t||n)return;const u=t;return t=null,h(this,u)},m}async function ne(e,a,i){return await e.apply(a,i)}function re(...e){const a=typeof e[e.length-1]=="string"?e.pop():void 0;ie(e[0],e[1])&&e.unshift(a);let[i,c,s={}]=e,_=!1;const n=B(()=>X(i));if(typeof n.value!="string")throw new TypeError("[nuxt] [useAsyncData] key must be a string.");if(typeof c!="function")throw new TypeError("[nuxt] [useAsyncData] handler must be a function.");const t=U();s.server??=!0,s.default??=ue,s.getCachedData??=j,s.lazy??=!1,s.immediate??=!0,s.deep??=z.deep,s.dedupe??="cancel",s._functionName,t._asyncData[n.value];function h(){const l={cause:"initial",dedupe:s.dedupe};return t._asyncData[n.value]?._init||(l.cachedData=s.getCachedData(n.value,t,{cause:"initial"}),t._asyncData[n.value]=M(t,n.value,c,s,l.cachedData)),()=>t._asyncData[n.value].execute(l)}const m=h(),r=t._asyncData[n.value];r._deps++;const u=s.server!==!1&&t.payload.serverRendered;{let l=function(d){const f=t._asyncData[d];f?._deps&&(f._deps--,f._deps===0&&f?._off())};const o=Y();if(o&&u&&s.immediate&&!o.sp&&(o.sp=[]),o&&!o._nuxtOnBeforeMountCbs){o._nuxtOnBeforeMountCbs=[];const d=o._nuxtOnBeforeMountCbs;Z(()=>{d.forEach(f=>{f()}),d.splice(0,d.length)}),$(()=>d.splice(0,d.length))}const D=o&&(o._nuxtClientOnly||x(K,!1));u&&t.isHydrating&&(r.error.value||r.data.value!==void 0)?r.status.value=r.error.value?"error":"success":o&&(!D&&t.payload.serverRendered&&t.isHydrating||s.lazy)&&s.immediate?o._nuxtOnBeforeMountCbs.push(m):s.immediate&&r.status.value!=="success"&&m();const y=W(),O=N(n,(d,f)=>{if((d||f)&&d!==f){_=!0;const R=t._asyncData[f]?.data.value!==void 0,I=t._asyncDataPromises[f]!==void 0,E={cause:"initial",dedupe:s.dedupe};if(!t._asyncData[d]?._init){let C;f&&R?C=t._asyncData[f].data.value:(C=s.getCachedData(d,t,{cause:"initial"}),E.cachedData=C),t._asyncData[d]=M(t,d,c,s,C)}t._asyncData[d]._deps++,f&&l(f),(s.immediate||R||I)&&t._asyncData[d].execute(E),k(()=>{_=!1})}},{flush:"sync"}),H=s.watch?N(s.watch,()=>{_||r._execute({cause:"watch",dedupe:s.dedupe})}):()=>{};y&&L(()=>{O(),H(),l(n.value)})}const v={data:T(()=>t._asyncData[n.value]?.data),pending:T(()=>t._asyncData[n.value]?.pending),status:T(()=>t._asyncData[n.value]?.status),error:T(()=>t._asyncData[n.value]?.error),refresh:(...l)=>t._asyncData[n.value]?._init?t._asyncData[n.value].execute(...l):h()(),execute:(...l)=>v.refresh(...l),clear:()=>V(t,n.value)},P=Promise.resolve(t._asyncDataPromises[n.value]).then(()=>v);return Object.assign(P,v),P}function T(e){return B({get(){return e()?.value},set(a){const i=e();i&&(i.value=a)}})}function ie(e,a){return!(typeof e=="string"||typeof e=="object"&&e!==null||typeof e=="function"&&typeof a=="function")}function V(e,a){a in e.payload.data&&(e.payload.data[a]=void 0),a in e.payload._errors&&(e.payload._errors[a]=void 0),e._asyncData[a]&&(e._asyncData[a].data.value=g(e._asyncData[a]._default()),e._asyncData[a].error.value=void 0,e._asyncData[a].status.value="idle"),a in e._asyncDataPromises&&(e._asyncDataPromises[a]&&(e._asyncDataPromises[a].cancelled=!0),e._asyncDataPromises[a]=void 0)}function ce(e,a){const i={};for(const c of a)i[c]=e[c];return i}function M(e,a,i,c,s){e.payload._errors[a]??=void 0;const _=c.getCachedData!==j,n=i,t=c.deep?q:F,h=s!==void 0,m=e.hook("app:data:refresh",async u=>{(!u||u.includes(a))&&await r.execute({cause:"refresh:hook"})}),r={data:t(h?s:c.default()),pending:B(()=>r.status.value==="pending"),error:G(e.payload._errors,a),status:F("idle"),execute:(...u)=>{const[v,P=void 0]=u,l=v&&P===void 0&&typeof v=="object"?v:{};if(e._asyncDataPromises[a]){if((l.dedupe??c.dedupe)==="defer")return e._asyncDataPromises[a];e._asyncDataPromises[a].cancelled=!0}{const D="cachedData"in l?l.cachedData:c.getCachedData(a,e,{cause:l.cause??"refresh:manual"});if(D!==void 0)return e.payload.data[a]=r.data.value=D,r.error.value=void 0,r.status.value="success",Promise.resolve(D)}r.status.value="pending";const o=new Promise((D,y)=>{try{D(n(e))}catch(O){y(O)}}).then(async D=>{if(o.cancelled)return e._asyncDataPromises[a];let y=D;c.transform&&(y=await c.transform(D)),c.pick&&(y=ce(y,c.pick)),e.payload.data[a]=y,r.data.value=y,r.error.value=void 0,r.status.value="success"}).catch(D=>{if(o.cancelled)return e._asyncDataPromises[a];r.error.value=Q(D),r.data.value=g(c.default()),r.status.value="error"}).finally(()=>{o.cancelled||delete e._asyncDataPromises[a]});return e._asyncDataPromises[a]=o,e._asyncDataPromises[a]},_execute:se((...u)=>r.execute(...u),0,{leading:!0}),_default:c.default,_deps:0,_init:!0,_hash:void 0,_off:()=>{m(),e._asyncData[a]?._init&&(e._asyncData[a]._init=!1),_||J(()=>{e._asyncData[a]?._init||(V(e,a),r.execute=()=>Promise.resolve())})}};return r}const ue=()=>{},j=(e,a,i)=>{if(a.isHydrating)return a.payload.data[e];if(i.cause!=="refresh:manual"&&i.cause!=="refresh:hook")return a.static.data[e]};function oe(e){return{}}const le={style:{padding:"24px"}},de={key:0},fe={key:1},_e={key:2},ve=A({__name:"test-ssr",setup(e){const a=typeof window>"u",{data:i,pending:c,error:s,refresh:_}=re("ssr-example",async()=>{const n=a?oe()["user-agent"]||"":typeof navigator<"u"?navigator.userAgent:"";return{serverTime:new Date().toISOString(),userAgent:n}},{server:!0,default:()=>({serverTime:"",userAgent:""})});return(n,t)=>(S(),p("section",le,[t[1]||(t[1]=b("h1",null,"SSR 示例页面",-1)),b("p",null,"首次渲染："+w(a?"服务端":"客户端"),1),g(s)?(S(),p("div",de,"加载失败："+w(g(s).message),1)):g(c)?(S(),p("div",fe,"加载中...")):g(i)?(S(),p("div",_e,[b("p",null,"服务器时间："+w(g(i).serverTime),1),b("p",null,"用户代理："+w(g(i).userAgent),1)])):ee("",!0),b("button",{onClick:t[0]||(t[0]=()=>g(_)())},"刷新数据（客户端）")]))}}),he=ae(ve,[["__scopeId","data-v-1113d2fb"]]);export{he as default};
